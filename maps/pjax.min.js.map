{"version":3,"sources":["pjax.js"],"names":["$","mainElement","theTop","notMobile","offset","top","window","addEventListener","e","state","document","title","animate","scrollTop","content","ajax","url","html","OriginTitile","dispatchEvent","pjaxEvents","complete","before","Event","success","error","reqUrl","needPushState","isSuccessRequest","beforeSend","load_comm","NProgress","start","data","textStatus","jqXHR","find","responseText","history","replaceState","location","href","newTitle","filter","text","newContent","pushState","reqId","match","open","done","timeout","errorThrown","console","on","this","attr","includes","decodeURI"],"mappings":"AAAAA,GAAE,WACE,MAAMC,EAAc,yBACpBC,OAASC,UAAYH,EAAE,qBAAqBI,SAASC,IAAI,GAAK,EAgB9DC,OAAOC,iBAAiB,YAdCC,IAChBA,EAAEC,QACHC,SAASC,MAAQH,EAAEC,MAAME,OAASD,SAASC,MAC3CX,EAAE,aAAaY,QAAQ,CAACC,UAAUX,QAAS,UACZ,IAApBM,EAAEC,MAAMK,QACfC,EAAKP,EAAEC,MAAMO,KAAK,GAElBhB,EAAEC,GAAagB,KAAMT,EAAEC,MAAMK,SAGjCI,aAAeR,SAASC,MACxBL,OAAOa,cAAcC,EAAWC,cAKxC,MAAMD,EAAa,CACfE,OAAU,IAAIC,MAAM,eACpBC,QAAU,IAAID,MAAM,gBACpBF,SAAU,IAAIE,MAAM,iBACpBE,MAAU,IAAIF,MAAM,eAGxB,SAASR,EAAKW,EAAQC,GAElB,IAAIC,GAAmB,EAEvB5B,EAAEe,KAAK,CACHC,IAAKU,EACLG,WAAY,WAGiB,oBAAdC,WAA2C,OAAdA,YACpCA,UAAY,MAIhB9B,EAAE,aAAaY,QAAQ,CAACC,UAAUX,QAAS,KAG3C6B,UAAUC,QAEV1B,OAAOa,cAAcC,EAAWE,SAEpCE,QAAS,SAASS,EAAMC,EAAYC,QAEgB,IAArCnC,EAAEiC,GAAMG,KAAKnC,GAAagB,SAEjCW,GAAmB,GAGvBtB,OAAOa,cAAcC,EAAWI,UAEpCH,SAAU,SAASc,EAAOD,GAEtB,GAAIN,EAAkB,CAClB,MAAMK,EAAOE,EAAME,aAGnBC,QAAQC,aAAa,CACjBvB,IAAKwB,SAASC,KACd9B,MAAOD,SAASC,MAChBG,QAASd,EAAEU,UAAU0B,KAAKnC,GAAagB,QACxCP,SAASC,MAAO6B,SAASC,MAG5B,MAAMC,EAAW1C,EAAEiC,GAAMU,OAAO,SAASC,OACnCC,EAAa7C,EAAEiC,GAAMG,KAAKnC,GAAagB,OAGzCU,GAEArB,OAAOgC,QAAQQ,UAAU,CACrB9B,IAAKU,EACLf,MAAO+B,EACP5B,QAAS+B,GACVH,EAAUhB,GAIjBhB,SAASC,MAAQ+B,EACjB1C,EAAEC,GAAagB,KAAK4B,GAGpB3B,aAAeR,SAASC,MAGxB,MAAMoC,EAAQrB,EAAOsB,MAAM,SACvBD,GACA/C,EAAE,aAAaY,QAAQ,CAACC,UAAUb,EAAE+C,EAAM,IAAI3C,SAASC,IAAM,IAAK,UAKtEC,OAAO2C,KAAKvB,GAIhBK,UAAUmB,OAEV5C,OAAOa,cAAcC,EAAWC,WAEpC8B,QAAS,IACT1B,MAAO,SAASU,EAAOD,EAAYkB,GAE/BC,QAAQ5B,MAAM2B,GAEdZ,SAASC,KAAOf,EAEhBpB,OAAOa,cAAcC,EAAWK,UAI5CzB,EAAEU,UAAU4C,GAAG,QAAS,oDAAoD,WACxE,MAAM5B,EAAS1B,EAAEuD,MAAMC,KAAK,QAC5B,YAAsB,IAAX9B,MACFA,EAAO+B,SAAU,iBACrB1C,EAAK2C,UAAUhC,IAAS,IACtB","file":"../js/pjax.min.js","sourcesContent":["$(function() {\r\n    const mainElement = '#kratos-blog-post .row';\r\n    theTop = notMobile ? $(\"#kratos-blog-post\").offset().top-40 : 0;\r\n\r\n    const popStateHandler = (e) => {\r\n        if ( e.state ) {\r\n            document.title = e.state.title || document.title;\r\n            $(\"body,html\").animate({scrollTop:theTop}, 600);\r\n            if (typeof e.state.content === 'undefined') {\r\n                ajax(e.state.url, false);\r\n            } else {\r\n                $(mainElement).html( e.state.content );\r\n            }\r\n            // 更新外域变量\r\n            OriginTitile = document.title;\r\n            window.dispatchEvent(pjaxEvents.complete);\r\n        }\r\n    };\r\n    window.addEventListener('popstate', popStateHandler);\r\n\r\n    const pjaxEvents = {\r\n        before:   new Event('pjax:before')  ,\r\n        success:  new Event('pjax:success') ,\r\n        complete: new Event('pjax:complete'),\r\n        error:    new Event('pjax:error')   ,\r\n    };\r\n\r\n    function ajax(reqUrl, needPushState) {\r\n\r\n        let isSuccessRequest = false;\r\n\r\n        $.ajax({\r\n            url: reqUrl,\r\n            beforeSend: function () {\r\n\r\n                // 防止评论区再被加载，重置加载函数\r\n                if (typeof load_comm !== 'undefined' && load_comm !== null) {\r\n                    load_comm = null;\r\n                }\r\n\r\n                // 运动到顶部\r\n                $(\"body,html\").animate({scrollTop:theTop}, 600);\r\n\r\n                // 进度条开始\r\n                NProgress.start();\r\n                \r\n                window.dispatchEvent(pjaxEvents.before);\r\n            },\r\n            success: function(data, textStatus, jqXHR) {\r\n                \r\n                if (typeof $(data).find(mainElement).html() !== 'undefined') {\r\n                    // 这样才成功嘛\r\n                    isSuccessRequest = true;\r\n                }\r\n\r\n                window.dispatchEvent(pjaxEvents.success);\r\n            },\r\n            complete: function(jqXHR, textStatus) {\r\n\r\n                if (isSuccessRequest) {\r\n                    const data = jqXHR.responseText;\r\n\r\n                    // 替换记录的当前状态\r\n                    history.replaceState({\r\n                        url: location.href,\r\n                        title: document.title,\r\n                        content: $(document).find(mainElement).html(),\r\n                    }, document.title, location.href);\r\n\r\n                    // 记录新状态的一些信息\r\n                    const newTitle = $(data).filter(\"title\").text();\r\n                    const newContent = $(data).find(mainElement).html();\r\n\r\n                    // 如果需要压入新的状态\r\n                    if (needPushState) {\r\n                        // 压入新的状态\r\n                        window.history.pushState({\r\n                            url: reqUrl,\r\n                            title: newTitle,\r\n                            content: newContent,\r\n                        }, newTitle, reqUrl);\r\n                    }\r\n\r\n                    // 更新当前页面需要更新的内容\r\n                    document.title = newTitle;\r\n                    $(mainElement).html(newContent);\r\n\r\n                    // 更新外域变量\r\n                    OriginTitile = document.title;\r\n                    \r\n                    // 如果URL里有指定节点ID，则滚动到相应的节点位置\r\n                    const reqId = reqUrl.match(/\\#.+$/);\r\n                    if (reqId) {\r\n                        $(\"body,html\").animate({scrollTop:$(reqId[0]).offset().top - 40}, 600);\r\n                    }\r\n                } else {\r\n                    // 其实是失败的\r\n                    // 不如打开一个新页面？\r\n                    window.open(reqUrl);\r\n                }\r\n\r\n                // 进度条结束\r\n                NProgress.done();\r\n\r\n                window.dispatchEvent(pjaxEvents.complete);\r\n            },\r\n            timeout: 6000,\r\n            error: function(jqXHR, textStatus, errorThrown) {\r\n\r\n                console.error(errorThrown);\r\n\r\n                location.href = reqUrl;\r\n                \r\n                window.dispatchEvent(pjaxEvents.error);\r\n            }\r\n        });\r\n    }\r\n    $(document).on(\"click\", 'a[target!=_blank][rel!=gallery][class!=toc-link]', function() {\r\n        const reqUrl = $(this).attr(\"href\");\r\n        if (typeof reqUrl === 'undefined') return true;\r\n        else if (reqUrl.includes( \"javascript:\")) return true;\r\n        else ajax(decodeURI(reqUrl), true);\r\n        return false;\r\n    });\r\n});\r\n"]}